{% extends 'layout.html.twig' %}



{% block stylesheets %}
	{# parent() }#}
  	{% stylesheets '@css_datatables' %}
      	<link rel="stylesheet" href="{{ asset_url }}" /></link>
  	{% endstylesheets %}
{% endblock %}

{% block javascripts %}
	{# parent() #}
    {% javascripts '@js_datatables'%}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body %}
	<style type="text/css">
		@media (min-width: 768px) {
		  .modal-xl {
		    width: 95%;
		    max-width:1600px;
		  }
		}
		.custom-modal{
			height: 2000%!important;
		}
				
		.text-area-larga{
			height: 467px!important;
		}
		
		.text-area-corta{
			height: 200px!important;
		}
		
		.text-area-mini{
			height: 80px!important;
		}
		
		.numero-fila{
			font-size: 150%;
			font-weight: bold;
			vertical-align: middle!important;
		}
		.herramienta-fila{
			vertical-align: middle!important;
		}
		
		.div-articulos{
			max-height: 449px;
			overflow-y:auto;
			overflow-x: hidden; 
		}
		
		.div-incisos{
			height: 250px;
			max-height: 260px;
			overflow-y:scroll;
			overflow-x: hidden; 
		}

		.tab{
			height: 502px;
			max-height:503px;
			/* overflow-y: auto;  */
		}
		
		.tab-active{
			background-color: #f8f8ff;
		}
			
		.toggle-on.btn{
			line-height: 22.5px!important;
		}
		.toggle-off.btn{
			line-height: 22.5px!important;
		}
					    
        .col-nopadding {
           padding: 0 !important;
           margin: 0 !important;
        }
           
        .selConcejales{
			height: 182px!important;
		    max-height: 183px!important;
		    overflow-y: auto!important;
		}
		.selComisiones{
		    min-height: 120px!important;
		    max-height: 121px!important;
		    overflow-y: auto!important;
		}     
	</style>
	<script type="text/javascript">
	
		wysihtml5.dom.getPastedHtml = function(event) {
    		var html;
    		if (event.clipboardData) {
    			html = event.clipboardData.getData('text/plain');
		  	}
		  	return html;
		};

		Array.prototype.reemplazar  = function(objeto, clave){
			   var array = $.map(this, function(v,i){
			      	return v[clave] == objeto[clave] ? objeto : v;
			   });
			   this.length = 0;
			   this.push.apply(this, array);
		};

		Array.prototype.renumerar  = function(clave,numeracion){
			   var semilla=(numeracion=='digito')?0:64;
			   var array = $.map(this, function(v,i){
			   		v[clave]=((numeracion=='digito')?(semilla+1):String.fromCharCode(semilla+1));
			   		semilla++;
			      	return v;
			   });
			   this.length = 0;
			   this.push.apply(this, array);
		};

		Array.prototype.eliminar  = function(clave,valor){
			    var array = $.map(this, function(v,i){
			      	return v[clave] == valor ? null : v;
			   });
			   this.length = 0;
			   this.push.apply(this, array);
		};

		function criterio(){
			var tipo=$("#selBusqueda").val();
			var valorRetorno;
			return ((tipo=="todo" || tipo=="busqueda-3" || tipo=="busqueda-4")?"0":$("#"+tipo).val());	
		}
		function tipoCriterio(){
			return $("#selBusqueda").val();
		}
		
		function habilitar(nombre){
			$(".tab").addClass("hidden");
			$(".selectable").removeClass("tab-active");
			
			$("#"+nombre).removeClass("hidden");
			$("#link-"+nombre).addClass("tab-active");
			$("#link-"+nombre).blur();
			
		}

		function aplicarAccion(accion, idAsignacion, tabla){
		 
			var formData= new FormData();
			formData.append("accion",accion);
			formData.append("idAsignacion",idAsignacion);
		
    		$.ajax({
                   async: true,
                   url: '{{ app.request.getBaseURL() }}'+'/api/expedienteComision/visualizacion/update',
                   data: formData,
                   cache: false,
                   contentType: false,
                   processData: false,
                   type:  'POST',
               success: function(data) {
                   toastr.success(data);
    				tabla.ajax.reload();
               	},
               error: function(jqXHR,textStatus,errorThrown ){
    				toastr.error(jqXHR.responseText);
    			}
           	});
		}

		function addClasssToSelect2(div,clase){
			$("#"+div).find('span[class="select2-selection select2-selection--multiple"]').addClass(clase);
		}

		function traerArticuloPorNumero(numero,articulosIngresados){
			var articuloBuscado;
			$.each(articulosIngresados,function(index,articulo){
				if(articulo.numero==numero) articuloBuscado=articulo;
			});
			return articuloBuscado;
		}

		function actualizarArticulo(articulo){

			numero=articulo.numero;
			var cuerpoArticulo='<div class="well well-sm">' +
							   '<div class="btn-group pull-right">'+
							   '<button type="button" class="btn btn-sm btn-primary btn-editar-articulo" title="Editar artículo">'+
							   		'Editar</button>'+
							   '<button type="button" class="btn btn-sm btn-warning" title="Cambiar orden" onClick="noImplementado();">'+
							   		'Mover</button>'+
							   '<button type="button" class="btn btn-sm btn-danger btn-eliminar-articulo" title="Eliminar artículo">'+
							   		'Eliminar</button></div>'+
							   '<div>'+articulo.texto+'<br><ul class="list-unstyled">';
							   
			$.each(articulo.incisos,function(index,inciso){
				texto=inciso.texto.replace(/<p>/g,'').replace(/<\/p>/g,'<br>');
				cuerpoArticulo+='<li style="padding-left:30px">'+inciso.orden+') - '+texto+'</li>';
			});

			cuerpoArticulo+='</ul></div>';

			var nuevoContenido='<td class="numero-fila">'+numero+'</td>'+
	        			 	   '<td>'+cuerpoArticulo+'</td>';

			$("#articulos > tbody > tr").each(function(){

				if($(this).find('td:first').html()==numero)
					$(this).html(nuevoContenido);
			});

		}
		
		function agregarArticulo(articulo){
			var numero=((articulo.hasOwnProperty('numero'))?articulo.numero:$("#articulos> tbody > tr").length+1);
			var cuerpoArticulo='<div class="well well-sm">' +
							   '<div class="btn-group pull-right">'+
							   '<button type="button" class="btn btn-sm btn-primary btn-editar-articulo" title="Editar artículo">'+
							   		'Editar</button>'+
							   '<button type="button" class="btn btn-sm btn-warning" title="Cambiar orden" onClick="noImplementado();">'+
							   		'Mover</button>'+
							   '<button type="button" class="btn btn-sm btn-danger btn-eliminar-articulo" title="Eliminar artículo">'+
							   		'Eliminar</button></div>'+
							   '<div>'+articulo.texto+'<br><ul class="list-unstyled">';
							   
			$.each(articulo.incisos,function(index,inciso){
				texto=inciso.texto.replace(/<p>/g,'').replace(/<\/p>/g,'<br>');
				cuerpoArticulo+='<li style="padding-left:30px">'+inciso.orden+') - '+texto+'</li>';
			});
		
			cuerpoArticulo+='</ul></div>';

			var nuevoArticulo='<tr>'+
	        			 	  '<td class="numero-fila">'+numero+'</td>' +
	        			 	  '<td>'+cuerpoArticulo+'</td>'+
	        			 	  '</tr>';

	        $("#articulos > tbody").append(nuevoArticulo);
	        $("#div-articulos").animate({ scrollTop: $("#div-articulos")[0].scrollHeight}, 1000);
	        articulo.numero=numero;
	        return articulo;
	        
		}

		function cargarInciso(nuevoInciso){
			var orden=nuevoInciso.orden;
			var inciso='<tr>'+
	        		   '<td class="numero-fila">'+orden+') -</td>' +
	        		   '<td><textarea class="form-control text-area text-area-mini" id="inciso-'+orden+'" '+
	        		   'name="inciso" placeholder="Inciso"></textarea></td>'+
	        		   '<td class="herramienta-fila"><div class="row text-center">'+
	        		   '<button type="button" class="btn btn-sm btn-info" onClick="noImplementado();"><span class="glyphicon glyphicon-tasks"></button>'+
	        		   '</div><div class="row text-center"><button type="button" class="btn btn-sm btn-danger btn-eliminar-inciso">'+
	        		   '<span class="glyphicon glyphicon-remove"></button></div></td>'+
	        		   '</tr>';

	        $("#incisos > tbody").append(inciso);
	        $("#inciso-"+orden).wysihtml5({
				toolbar: {
				    "image": false,
					"size": "xs",
				},
			});
			$("#inciso-"+orden).data("wysihtml5").editor.setValue(nuevoInciso.texto);
		}
		
		
		function agregarInciso(){
			var letra=String.fromCharCode($("#incisos").find('tr').length+65);
			var inciso='<tr>'+
	        		   '<td class="numero-fila">'+letra.toLowerCase()+') -</td>' +
	        		   '<td><textarea class="form-control text-area text-area-mini" id="inciso-'+letra+'" '+
	        		   'name="inciso" placeholder="Inciso"></textarea></td>'+
	        		   '<td class="herramienta-fila"><div class="text-center">'+
	        		   '<button type="button" class="btn btn-sm btn-info" onClick="noImplementado();"><span class="glyphicon glyphicon-tasks"></button>'+
	        		   '</div><div class="row text-center"><button type="button" class="btn btn-sm btn-danger btn-eliminar-inciso">'+
	        		   '<span class="glyphicon glyphicon-remove"></button></div></td>'+
	        		   '</tr>';

	        $("#incisos > tbody").append(inciso);
	        $("#inciso-"+letra).wysihtml5({
				toolbar: {
				    "image": false,
					"size": "xs",
				},
			});
			$("#div-incisos").animate({ scrollTop: $("#div-incisos")[0].scrollHeight}, 1000);
		}

		$(document).ready(function () {

			var articulosIngresados=[];

			var tablaVersionesProyectos;
			
		    var tabla=$('#registroAsignaciones').DataTable({
		    			  "language": {
				              "infoEmpty": "Sin registros para mostrar",
				              "paginate": {
						          	"last": "Ultima Página",
						          	"first": "Primer página",
						          	"next": "Siguiente",
						          	"previous": "Anterior"
						       },
						       "search":"Búsqueda rápida",
						       "emptyTable": "Sin Datos",
						       "lengthMenu": 'Registros Listados <select class="form-control input-sm">'+
								             '<option value="10">10</option>'+
								             '<option value="20">20</option>'+
								             '<option value="30">30</option>'+
								             '<option value="40">40</option>'+
								             '<option value="50">50</option>'+
								             '<option value="-1">Todos</option>'+
								             '</select>',
								"loadingRecords": "Espere...cargando datos",
								"processing": "Procesando...",
								"sInfo": "Mostrando  _START_ a _END_ de _TOTAL_ registros",

			          	  },
					      "processing": false,
					      "ajax": {
							        "url": "api/expedienteComision/getByCriteria/"+tipoCriterio()+"/"+criterio(),
			            			"dataSrc": '',
							    },
						  "columnDefs": [
								            {
								                "targets": [ 0 ],
								                "visible": false,
								                "searchable": false
								            },
								            {
									            "targets": [ 1 ],
									            "data": null,
									            "orderable":false,
									            "render": function(data, type, row){
										            var html="<div class='btn-group'>";
											        html+="<button type='button' title='Publicar' class='btn btn-primary btn-xs btn-publicar' data-toggle='modal' data-target='#'><span class='glyphicon glyphicon-eye-open'></span></button>";
											        html+="<button type='button' title='Anular Asignación' class='btn btn-danger btn-xs btn-anular' data-toggle='modal' data-target='#'><span class='glyphicon glyphicon-minus-sign'></span></button>";
													html+="</div>";
									            	return html;
									            }
									        },
									        {
									            "targets": [ 3 ],
									            "data": null,
									            "orderable":true,
									            "render": function(data, type, row){
									            	html="<button type='button'title='Editar Comision' class='btn btn-primary btn-xs btn-editar ' data-toggle='modal' data-target='#cambioComision'><span class='glyphicon glyphicon-pencil'></span></button> ";
								            		html+=data;
								            		return html;
									            }
									        },
									        {
									            "targets": [ 4 ],
									            "data": "publicado",
									            "orderable":true,
									            "render": function(data, type, row){
									            	return ((data==false)?"NO":"SI");
									            }
									        },
									        {
									            "targets": [ 6 ],
									            "data": "dictamen.id",
									            "orderable":false,
									            "render": function(data, type, row){
													var html="<div class='btn-group'style='margin-left:5px'>";
													if (row.tiene_dictamen==false){
														html+="<span class='label label-danger'>Sin Dictamen</span>";
														html+="<button type='button' title='Agregar Dictamen' class='btn btn-primary btn-xs btn-nuevo-dictamen' data-toggle='modal' data-target='#modalDictamen'><span class='glyphicon glyphicon-paperclip'></span></button>";
													}
													else{
															html+="<span class='label label-success'>Con Dictamen</span>";
															html+="<button type='button' title='Editar Dictamen' class='btn btn-info btn-xs btn-editar-dictamen' data-toggle='modal' data-target='#'><span class='glyphicon glyphicon-pencil'></span></button>";
															html+="<button type='button' title='Descargar Dictamen' class='btn btn-info btn-xs btn-descargar'><span class='glyphicon glyphicon-save-file'></span></button>";
														}
									            	return html+"</div>";	
									            }
									        }	       
						  ],
					      "columns": [
					      		{ "data": "id" },
					      		{ "data": "null","width":"7%"},
					      		{ "data": "expediente.numero_completo","width":"10%"},
					            { "data": "comision.comision","width":"39%" },
					            { "data": "publicado","width":"8%" },
					            { "data": "fecha_publicacion_formateada","width":"8%" },
					            { "data": "dictamen.id", "width": "28%"},
					        ],
					      "autoWidth":false,
					      "paging": true,
					      "lengthChange": true,
					      "searching": true,
					      "ordering": true,
					      "info": true,
					      "autoWidth": false,
				});
		    
		    $('#registroAsignaciones tbody').on( 'click', '.btn-descargar', function () {
		        var data = tabla.row( $(this).parents('tr') ).data();
		        window.location.href='{{ app.request.getBaseURL() }}'+
		        					 '/imprimir?tipoDocumento=expediente&id='+
		        					  data[ "id" ];
		    } );

			//EVENTO EDITAR DICTAMEN DE LA GRILLA DE ASIGNACIONES
		    $('#registroAsignaciones tbody').on( 'click', '.btn-editar-dictamen', function () {
		        var data = tabla.row( $(this).parents('tr') ).data();
		        $("#modalDictamen").find('input[name="idAsignacion"]').val(data[ "id" ]);
		        $("#modalDictamen").find('input[name="idDictamen"]').val(data[ "dictamen.id" ]);
		    });

			/*
			$("#modalDictamen").on('show.bs.modal', function () {

				var idAsignacion=$("#modalDictamen").find('input[name="idAsignacion"]').val();
				var idDictamen=$("#modalDictamen").find('input[name="idDictamen"]').val();
				
				if (idDictamen==0){
					$("#selTipoRedaccion").val("basico");
			        $("#selTipoRedaccion").change();
			        $("#selNumeroDictaminantes").val(0)
			        $("#selConcejales").empty().change();
			        $("#selComisiones").empty().change();
			        $("#texto").data("wysihtml5").editor.setValue('');
			        $("#articulos > tbody").html('');
				}
				else{
            		    $.ajax({
            				type:'Get',
            				dataType: 'json	',
            				url:'{{ app.request.getBaseURL() }}'+'/api/expedienteComision/dictamen/getOne/'+idDictamen,
            				success: function(data){
            
            					$("#selTipoRedaccion").val(data.clase_dictamen);
            					$("#selTipoRedaccion").change();

            					if (data.clase_dictamen=="articulado")
            						$("#selTipoDictamen").val(data.tipo_dictamen);

            					$("#selNumeroDictaminantes").val(data.tipo_numero_dictamen);           			
            					$("#texto").data("wysihtml5").editor.setValue(data.textoLibre);
            
            				 	var concejales=data.concejales;
            
            				 	//selección de los concejales almacenados
            				 	$.each(concejales, function(index,concejal){
            				 		var newOption = new Option(concejal.descripcion, concejal.id, true, true);
            					   	$("#selConcejales").append(newOption).trigger('change');
            					 });
            
            				 	var comisiones=data.comisiones;
            
            				 	//selección de los bloques almacenados
            				 	$.each(comisiones, function(index,comision){
            				 		var newOption = new Option(comisiones.comision, comision.id, true, true);
            					   	$("#selComisiones").append(newOption).trigger('change');
            					 });
            				 
            				    $.each(data.articulos,function(index,articulo){
            						agregarArticulo(articulo,'articulos');
            					});
            
            				    articulosIngresados=data.articulos;            				    
            				},
            				error: function(jqXHR,textStatus,errorThrown ){
            					//var response=JSON.parse(jqXHR.responseText)
            					toastr.error(jqXHR.responseText);
            				}
            	      	});
				}
		        
		    } );
		    */
		    
			//EVENTO NUEVO DICTAMEN DE LA GRILLA DE ASIGNACIONES	
		    $('#registroAsignaciones tbody').on( 'click', '.btn-nuevo-dictamen', function () {
		        var data = tabla.row( $(this).parents('tr') ).data();
		        $("#modalDictamen").find('input[name="idAsignacion"]').val(data[ "id" ]);
		    } );
			//---------------------------------------------------------------------------------------------------------------
			//---------------------------------------PUBLICACIÓN y ANULACIÓN-------------------------------------------------
			//---------------------------------------------------------------------------------------------------------------
						
			$('#registroAsignaciones tbody').on( 'click', '.btn-publicar', function () {			
				 var data = tabla.row( $(this).parents('tr') ).data();
				 idAsignacion=data[ "id" ];
				 aplicarAccion("publicar", idAsignacion,tabla);
			}); 

			$('#registroAsignaciones tbody').on( 'click', '.btn-anular', function () {			
				 var data = tabla.row( $(this).parents('tr') ).data();
				 idAsignacion=data[ "id" ];
				 aplicarAccion("anular", idAsignacion,tabla);
			}); 
			
			//---------------------------------------------------------------------------------------------------------------
			//---------------------------------------EDICIÓN DE LA COMISIÓN--------------------------------------------------
			//---------------------------------------------------------------------------------------------------------------

			//EVENTO BOTON EDITAR COMISION EN GRILLA
		    $('#registroAsignaciones tbody').on( 'click', '.btn-editar', function () {
		        var data = tabla.row( $(this).parents('tr') ).data();
		        $("#cambioComision").find('input[name="idAsignacion"]').val(data[ "id" ]);
		    } );

			//BOTON ACEPTAR DEL MODAL DE EDICIÓN DE COMISIÓN
		    $("#btn-cambio-comision").click(function(){

		    	$(this).prop("disabled",true);
				
				var idAsignacion = $("#cambioComision").find('input[name="idAsignacion"]').val();
				var idNuevaComision = $("#cambioComision").find('select[name="selComisionEdicion"]').val();
				
              	var formData=new FormData();
                var validacion='';

                formData.append('idAsignacion',idAsignacion);
              	formData.append('idNuevaComision',idNuevaComision);
              	validacion+=((idNuevaComision==0)?'<li>Debe seleccionar una comision</li>':'');

              	 if (validacion.length>0) 
 				{
 					validacion=((validacion.length>0)?'<strong>Validacion de Datos</strong><br><ul>'+
 								validacion+'</ul>':'');
 					toastr.error(validacion);
 					$(this).prop("disabled", false);
 					return false;
 				}
 				else{

 	            	$.ajax({
 		                async: true,
 		                url: '{{ app.request.getBaseURL() }}'+'/api/expedienteComision/comision/update',
 		                data: formData,
 		                cache: false,
 		                contentType: false,
 		                processData: false,
 		                type: 'POST',
 	                success: function(data) {
 	                    toastr.success(data);
 						tabla.ajax.reload();
 						$('#cambioComision').modal('hide');
 	                	},
 	                complete:function(){
 	                	$(this).prop("disabled", false);
 	                },
 	                error: function(jqXHR,textStatus,errorThrown ){
 						toastr.error(jqXHR.responseText);
 						}
 	            	});
 	            }
			    
			 });

		  //---------------------------------------------------------------------------------------------------------------
		  //----------------------------------------------ARTICULADO-------------------------------------------------------
		  //---------------------------------------------------------------------------------------------------------------

			//EVENTO CLICK DEL BOTON DE NUEVO ARTICULO EN EL MODAL DE DICTAMEN
			$("#btn-nuevo-articulo").click(function(){
				$("#modalArticulo").find('input[name="id"]').val(0);
				$("#modalArticulo").modal('show');	
			});		  	
		  
			//EVENTO CLICK DEL BOTON EDITAR DE LAS FILAS EN LA TABLA DE ARTICULOS
			$("#articulos > tbody").on('click','.btn-editar-articulo',function(){
				var numero=$(this).parents("tr").find('td:first').text();
				$("#modalArticulo").find('input[name="id"]').val(numero);
				$("#modalArticulo").modal('show');	
			});

			//EVENTO MOSTRAR DEL MODAL DEL MODAL DE ARTICULO
			$("#modalArticulo").on('show.bs.modal', function () {
				var numeroArticulo= $("#modalArticulo").find('input[name="id"]').val();
				$("#articulo").data("wysihtml5").editor.setValue('');
				$("#incisos > tbody").html('');
				if (numeroArticulo!=0){
    				var articulo=traerArticuloPorNumero(numeroArticulo,articulosIngresados);
    				$("#articulo").data("wysihtml5").editor.setValue(articulo.texto);
    				
    				$.each(articulo.incisos,function(index,inciso){
    					cargarInciso(inciso);
    				});
				}
			});

			//EVENTO CLICK DEL BOTON ELIMINAR DE LAS FILAS EN LA TABLA DE ARTICULOS
			$("#articulos > tbody").on('click','.btn-eliminar-articulo',function(){
				var numero=$(this).parents("tr").find('td:first').text();
				articulosIngresados.eliminar('numero',numero);
				articulosIngresados.renumerar('numero','digito');
				$("#articulos > tbody").html('');
				$.each(articulosIngresados,function(i,articulo){
					agregarArticulo(articulo,'articulos');
				});
			});
			
			//EVENTO CLICK DEL BOTON ELIMINAR DE LAS FILAS EN LA TABLA DE INCISOS
			$("#incisos > tbody").on('click','.btn-eliminar-inciso',function(){
				var orden=$(this).parents("tr").remove();
				orden=64;
				$("#incisos > tbody > tr").each(function(){
					orden++;
					$(this).find("td:first").text(String.fromCharCode(orden).toLowerCase() + ") -");
				})
			});

			//EVENTO ACEPTAR DEL MODAL DE ARTICULOS
			$("#btn-agregar-articulo").click(function(){
				
				var validacion='';
				var incisos=[];
	
				$("#incisos").find('tr').each(function(i,row){
					var textarea=$(row).find("textarea");
					var	orden=$(row).find("td:first").text().replace(/ |\)|-/g,'');
					var texto=$(textarea).val();

					if(texto.length==0)
						validacion+='<li>El inciso '+ orden +' no posee texto</li>';

					if (validacion.length==0){
						inciso={
							orden: orden,
							texto: texto
						}
						incisos.push(inciso);
					}
					else{
						if (incisos.length>0)
							incisos=[];
					}
				});

				if($("#articulo").val().length==0){
					validacion='<li>El artículo no posee texto</li>'+validacion;

				}

				if (validacion.length>0) 
				{
					Validacion=((validacion.length>0)?'<strong>Validacion de Datos</strong><br><ul>'+
								validacion+'</ul>':'');
					toastr.error(validacion);
					return false;
				}
				else{
					
 					var numero=$("#modalArticulo").find('input[name="id"]').val();	
					var texto=$("#articulo").val();

					if(numero==0){
						var articuloActual={
            								texto: texto,
            								incisos:incisos
                							}

						articuloActual=agregarArticulo(articuloActual);
						articulosIngresados.push(articuloActual);
					}
					else{
							var articuloActual={
                								numero: numero,
                								texto: texto,
                								incisos:incisos
                    							}
							
							actualizarArticulo(articuloActual);
							articulosIngresados.reemplazar(articuloActual,'numero'); 
						}
					
					$('#modalArticulo').modal('hide');
				}
			});

		    //------------------------------------------------------------------------------------------------------------
			//---------------------------------INICIALIZACIÓN DE CONTROLES------------------------------------------------
			//------------------------------------------------------------------------------------------------------------
							
			$(".text-area").wysihtml5({
				toolbar: {
				    "image": false,
					"size": "xs",
				},
			});

			$("#selConcejales").select2({
				ajax: {
			    url: '{{ app.request.getBaseURL() }}'+"/api/legislador/nombre/getByCriteria",
			    dataType: 'json',
			    delay: 250,
			    cache: false,
			    data: function (params) {
			      return {
			        q: params.term, // search term
			        page: params.page
			      };
			    },
			    processResults: function (data) {
			       var dato=data;
		           return {
				        results: $.map(dato, function(item) {
				            return { id: item.id, text: item.descripcion };
				        })
				    };
		        },
			  },
			  language: "es",
			  minimumInputLength: 3,
			  theme: "bootstrap",
			});

			$("#selComisiones").select2({
				ajax: {
			    url: '{{ app.request.getBaseURL() }}'+"#",//"/api/comisiones/getByCriteria",
			    dataType: 'json',
			    delay: 250,
			    cache: false,
			    data: function (params) {
			      return {
			        q: params.term, // search term
			        page: params.page
			      };
			    },
			    processResults: function (data) {
			       var dato=data;
		           return {
				        results: $.map(dato, function(item) {
				            return { id: item.id, text: item.comision };
				        })
				    };
		        },
			  },
			  language: "es",
			  minimumInputLength: 3,
			  theme: "bootstrap",
			});

			addClasssToSelect2("group-selComisiones","selComisiones");
			addClasssToSelect2("group-selConcejales","selConcejales");
			
			$('#estadoFiltro').bootstrapToggle({
		      on:  'Activo',
		      off: 'Inactivo',
		      offstyle: 'primary',
		      onstyle: 'success',
		      width: "80px",
		      height: "35px"
		    });

			$(".busqueda").addClass('hidden');
			$("#selBusqueda").val("todo");
			$('#estadoFiltro').bootstrapToggle('disable');

			$("#selBusqueda").change(function(){

				var control=$(this).val();
				$(".busqueda").addClass('hidden');
				if(control!="todo")
					$("#"+control).removeClass('hidden');
				else{
					$("#busqueda-1").val("");
					$("#busqueda-2").val("0");
				}
			});

			$("#btn-busqueda").click(function(){
				var valorBusqueda=$("#selBusqueda").val();
				if(((valorBusqueda=="busqueda-1"|| valorBusqueda=="busqueda-2") && criterio()!="" && criterio()!="0") ||
					valorBusqueda=="busqueda-3"|| valorBusqueda=="busqueda-4")
				{
					tabla.ajax.url("api/expedienteComision/getByCriteria/"+tipoCriterio()+"/"+criterio()).load();
					$(".filtro").prop('disabled',true);
					$('#estadoFiltro').bootstrapToggle('enable');
					$("#estadoFiltro").bootstrapToggle('on');
				}
			});

			$('#estadoFiltro').change(function() {
				if(!$(this).is(':checked')){
					$(".filtro").prop('disabled',false);
					$("#selBusqueda").val("todo").change();
					$(".filtro").prop('disabled',false);
					tabla.ajax.url("api/expedienteComision/getByCriteria/"+tipoCriterio()+"/"+criterio()).load();
					$(this).bootstrapToggle('disable');
					
				}
			});

			$("#selTipoRedaccion").change(function(){
				if ($(this).val()=="basico"){
					$("#group-tipoDictamen").addClass("hidden");
					$("#link-tab-2").addClass("hidden");
					habilitar("tab-1");	
				}
				else {
					$("#group-tipoDictamen").removeClass("hidden");
					$("#link-tab-2").removeClass("hidden");
					$("#selTipoDictamen").val(0);
				}
			});

	});
	</script>
	<section class="content-header">
		<div class="row pull-right">
			<ol class="breadcrumb">
		        <li><a href="#"><i class="fa fa-dashboard"></i> Principal</a></li>
		        <li>Comisiones</li>
		        <li class="active">Expedientes Girados</li>
		        
		    </ol>
		</div>
		<hr>
		<div class="row">
			<div class="col-md-3">
				<h2>
			        Expedientes Girados
			    </h2>
			</div>
			<div class="col-md-7 col-md-offset-2">
				<nav class="navbar navbar-default">
					<div class="container-fluid">
						<div class="navbar-header">
							<label class="navbar-brand">Filtro</label>
						</div>
						<div class="collapse navbar-collapse">
							<div>
								<form class="navbar-form navbar-left">
									<div class="form-group">
										<div class="form-group text-center">
											<input type="checkbox" id="estadoFiltro" data-size="normal"/>
							        	</div> 
										<button type="button" class="btn btn-primary filtro" id="btn-busqueda">Aplicar</button>
										<select class="form-control filtro" id="selBusqueda">
											<option value="todo">Todo</option>
											<option value="busqueda-1">Número Expediente</option>
											<option value="busqueda-2">Comision</option>
											<option value="busqueda-3">Sin Publicar</option>
											<option value="busqueda-4">Sin Dictamen</option>
										</select>
										<input class="form-control busqueda hidden filtro" id="busqueda-1"/>
										<select class="form-control busqueda hidden filtro" id="busqueda-2">
											<option value="0">Seleccione Comisión</option>
											{% for comision in comisiones %}
								                <option value="{{ comision.id }}">{{ comision.comision }}</option>
								            {% endfor %}
										</select>										
									</div>
								</form>
							</div>
						</div>
					</div>
				</nav>
				
			</div>
	    </div> 
	</section>
	<section class="content">
	  	<div class="row">
	    	<div class="col-xs-12">
              	<table id="registroAsignaciones" class="table table-striped">
	                <thead>
	                	<tr>
	                		<th>id</th>
	                		<th>
	                			<div class="btn-group">
	                				{# if EXP_NEW is defined #}
		                			<button type="button" title="Agregar Asignación"class="btn btn-primary btn-xs" data-toggle="modal" data-target="#">
							    			<span class="glyphicon glyphicon-plus"></span>
							    	</button>
							    	{# endif #}
							    </div>
						    </th>	
						    <th>Expdiente</th>
			                <th>Comision</th>
			                <th>Publicado</th>
			                <th title="Fecha Publicacion">F. Pub.</th>
			                <th>Dictamen</th>
	                	</tr>
	                </thead>
	                <tbody>
	                </tbody>
               	</table>     
	        </div> {# col #}
	    </div> {# row #}
	    <div id="cambioComision" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false" >
			<div class="modal-dialog">
			    <!-- Modal content-->
			    <div class="modal-content">
				    <div class="modal-header" style="background-color:#666	;color:#FFF">
		    			<button type="button" class="close" data-dismiss="modal">&times;</button>
		    			<h4 class="modal-title">Edición Comisión</h4>
				    </div>
				    <div class="modal-body" style="background-color:#ecf0f5">
				    	<form role="form">
				    		<input type="hidden" id="idAsignacion" name="idAsignacion">
				    		<div class="row">
				    			<div class="form-group col-md-12">
    				    			<label for="selComisionEdicion">Comisión</label>
    				    			<select class="form-control" id="selComisionEdicion" name="selComisionEdicion">
    									<option value="0">Seleccione Nueva Comisión</option>
    									{% for comision in comisiones %}
    						                <option value="{{ comision.id }}">{{ comision.comision }}</option>
    						            {% endfor %}
    								</select>
    							</div>
                			</div>
                			<hr>
    				    	<div class="row">
    				    		<div class="col-md-12">
					        		<div class="text-center">
						    			<div class="btn-group">
								        	<button type="button" class="btn btn-info" data-dismiss="modal">Cancelar</button>
				       			 			<button type="button" class="btn btn-primary" id="btn-cambio-comision">Aceptar</button>
								        </div>
							        </div>
							    </div>
    				    	</div>
				    	</form>
				    </div>
				</div>
			</div>
		</div>
		<div id="modalDictamen" class="modal fade custom-modal" role="dialog" data-backdrop="static" 
   data-keyboard="false">
		 	<div class="modal-dialog modal-xl">
			    <!-- Modal content-->
			    <div class="modal-content">
				    <div class="modal-header" style="background-color:#666	;color:#FFF">
		    			<button type="button" class="close" data-dismiss="modal">&times;</button>
		    			<h4 class="modal-title">Nuevo Dictamen</h4>
				    </div>
				    <div class="modal-body" style="background-color:#ecf0f5">
				    	<input type="hidden" id="idAsignacion" name="idAsignacion"> 
				    	<input type="hidden" id="idDictamen" name="idDictamen"> 
					    <div class="row">
					    	<div class="col-md-3">
					    		<div class="form-group">
					        		<label for="selTipoRedaccion">Tipo Redacción</label>
					        		<select class="form-control" id="selTipoRedaccion" 
					        				name="selTipoRedaccion">
						        		<option value="basico" selected="selected">Básico</option>
						        		<option value="articulado">Articulado</option>		
					        		</select>
					        	</div>
					        	<div style="min-height: 68.78px">
    					    		<div class="form-group hidden" style="margin-bottom: 0px!important" id="group-tipoDictamen">
    					        		<label for="selTipoDictamen">Tipo Dictamen</label>
    					        		<select class="form-control" id="selTipoDictamen" 
    					        				name="selTipoDictamen">
    					        			<option value="0">Seleccione Tipo Dictamen</option>
    					        			{% for tipo in tipoProyectos %}
    							                <option value="{{ tipo.id }}">{{ tipo.tipoProyecto }}</option>
    							            {% endfor %}
    					        		</select>
    					        	</div>
    					        </div>
					        	<div class="form-group">
					        		<label for="selNumeroDictaminantes">Número Dictaminantes</label>
					        		<select class="form-control" id="selNumeroDictaminantes" 
					        				name="selNumeroDictaminantes">
					        			<option value="0">Seleccione Numero</option>
					        			{% for numero in numeroDictaminantes %}
							                <option value="{{ numero.id }}">{{ numero.tipoNumeroDictamen }}</option>
							            {% endfor %}
					        		</select>
					        	</div>
					        	<div class="form-group" id="group-selComisiones">
						        	<label for="selComisiones">Comisiones:</label>
						        	<select class="form-control" multiple="multiple" data-width="100%" 
						        			id="selComisiones" name="selComisiones">
						        	</select>
						        </div>
					    		<div class="form-group" id="group-selConcejales">
						        	<label for="selConcejales">Concejales:</label>
						        	<select class="form-control" multiple="multiple" data-width="100%" 
						        			id="selConcejales" name="selConcejales"></select>
						        </div>
					    	</div>
					    	<div class="col-md-9">
					    		<div class="row">
					    			<div class="col-md-12">
					    				<nav>
        								    <ul class="nav nav-pills">
        									    <li role="presentation"><a href="#" id="link-tab-1" class="selectable" onclick = "habilitar('tab-1')" ><h4>Texto</h4></h4></a></li>
        										<li role="presentation"><a href="#" id="link-tab-2" class="selectable hidden" onclick = "habilitar('tab-2')"><h4>Artículos</h4></a></li>
        									</ul>
        								</nav>
					    			</div>		
					    		</div>
					    		<br>
							    <div class="row tab" id="tab-1">
							    	<div class="col-md-12">
									    <div class="row">
									    	<div class="col-md-12">
								        		<textarea class="form-control text-area text-area-larga" 
								        		id="texto" name="texto" placeholder="Texto Libre"></textarea>
									        </div>
								        </div> 
							        </div> 
					        	</div>
						        <div class="row tab hidden" id="tab-2">
					        		<div class="col-md-12">
							        	<div class="row" style="padding-top:5px">
							        		<div class="col-md-12">
									        	<div class="div-articulos" id="div-articulos">
									        		<table class="table table-striped" id="articulos">
									        			<tbody>
										        		</tbody> 
									        		</table> 	
										        </div>
										    </div>
										</div>
										<th>	
										<div class="row" style="padding-top: 15px;">
											<div class="col-md-12">
								        		<button type="button" class="btn btn-primary btn-sm" id="btn-nuevo-articulo"
								        		        style="margin-left:15px" >Nuevo Artículo</button>
								        	</div>
										</div>
								    </div>
						        </div>
					        </div>
					    </div>
				        <hr>
				        <div class="row">
				        	<div class="col-md-12">
				        		<div class="text-center">
					    			<div class="btn-group">
							        	<button type="button" class="btn btn-info" data-dismiss="modal">Cancelar</button>
						       			 <button type="button" class="btn btn-primary" id="btn-guardar-dictamen">Guardar</button>
							        </div>
						        </div>
						    </div>
			    		</div>
				    </div>
			    </div>
		  	</div>
		</div>

		<div id="modalArticulo" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
		 	<div class="modal-dialog modal-xl">
			    <!-- Modal content-->
			    <div class="modal-content">
				    <div class="modal-header" style="background-color:#666	;color:#FFF">
		    			<button type="button" class="close" data-dismiss="modal">&times;</button>
		    			<h4 class="modal-title">Nuevo Artículo</h4>
				    </div>
				    <div class="modal-body" style="background-color:#ecf0f5">
			        	<input type="hidden" id="id" name="id">
			        	<div class="row">
			        		<div class="col-md-12">
			        			<div class="form-group">
					        		<label for="articulo">Articulo:</label>
					        		<textarea class="form-control text-area text-area-corta" 
					        		id="articulo" name="articulo" placeholder="articulo"></textarea>
					        	</div>
					        </div>
					    </div>
					    <div class="row">
			        		<div class="col-md-12">
			        			<div class="row">
			        				<div class="col-md-12">
								        <label>Incisos:</label>
								        <button type="button" onClick="agregarInciso();" class="btn btn-primary btn-sm pull-right">Agregar Inciso</button>
								    </div>
								</div>
								<div class="row" style="padding-top:5px">
									<div class="col-md-12">
								        <div class="div-incisos" id="div-incisos">
							        		<table class="table table-striped" id="incisos">
							        			<tbody>
								        		</tbody> 
							        		</table> 	
								        </div>
								    </div>
								</div>		
					        </div> 
					    </div>
				        <hr>
				        <div class="row">
				        	<div class="col-md-12">
				        		<div class="text-center">
					    			<div class="btn-group">
							        	<button type="button" class="btn btn-info" data-dismiss="modal">Cancelar</button>
			       			 			<button type="submit" class="btn btn-primary" id="btn-agregar-articulo">Aceptar</button>
							        </div>
						        </div>
						    </div>
			    		</div>
				     </div>
			    </div>
		  	</div>
		</div>
	</section>
{% endblock %}